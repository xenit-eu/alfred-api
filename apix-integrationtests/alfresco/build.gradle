def integrationTestsProjectDir = project.projectDir
allprojects {
    // Subproject of supported Alfresco versions
    def subproject_alfresco_version = project.projectDir.name == "alfresco"
            ? "231" // minimum supported version
            : project.projectDir.name

    // Following needs to apply to shared (./src) project and version-specific (e.g. ./231) projects.
    apply plugin: 'idea'
    apply plugin: 'java-library'
    apply plugin: 'eu.xenit.alfresco'
    apply from: "${rootProject.projectDir}/alfresco/${subproject_alfresco_version}/overrides.gradle"
    // Setting integration test source
    sourceSets {
        main.java.srcDirs = []
        main.resources.srcDirs = []
        integrationTest.java.srcDirs = ["${integrationTestsProjectDir}/src/main/java"]
        integrationTest.resources.srcDirs = ["${integrationTestsProjectDir}/src/main/resources"]
    }

//    configurations {
//        implementation {
//            // Fixes IDE source highlighting
//            extendsFrom integrationTestImplementation
//        }
//        testImplementation {
//            extendsFrom integrationTestImplementation
//        }
//        integrationTestImplementationLocal {
//            // Removes weird dependency lodged inside the remote testing tools
//            // https://github.com/xenit-eu/alfresco-remote-testrunner/blob/564df30f25dab78f6a7aad02f3ba01fcf9a38b13/alfresco-remote-testrunner-gradle-plugin/src/main/java/eu/xenit/testing/integrationtesting/gradle/internal/IntegrationTestConfigurations.java#L84
//            exclude(group: 'commons-lang', module: 'commons-lang')
//        }
//    }

    dependencies {
        alfrescoProvided(project(":apix-rest-v1")) { transitive = false }
        alfrescoProvided(project(":apix-interface")) { transitive = false }

        alfrescoProvided platform("org.alfresco:acs-community-packaging:${alfresco_version}")
        alfrescoProvided("org.alfresco:alfresco-repository")
        alfrescoProvided('org.alfresco:alfresco-remote-api')
        alfrescoProvided('org.alfresco:alfresco-data-model')
        alfrescoProvided group: 'org.osgi', name: 'org.osgi.core', version: '4.3.1'


        testImplementation group: 'org.mockito', name: 'mockito-core', version: '5.0.0'
//        implementation group: 'org.mockito', name: 'mockito-core', version: '5.0.0'
        // JUnit 5 dependencies
        testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.1'
        testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.1'
        testImplementation 'org.junit.jupiter:junit-jupiter-params:5.9.1'

        testImplementation project.sourceSets.integrationTest.output

    }

//    test {
//        useJUnitPlatform()
//    }
}

subprojects {
    // Subproject of supported Alfresco versions
    def projectApixImpl = project(":apix-impl:apix-impl-${project.projectDir.name}")
    def projectDocker = project(":apix-docker:docker-${project.projectDir.name}")
    evaluationDependsOn(projectApixImpl.path)
    evaluationDependsOn(projectDocker.path)
    def assembleTask = projectApixImpl.tasks.getByName("assemble")
    def composeUpTask = projectDocker.tasks.getByName("composeUp")
    def composeDownTask = projectDocker.tasks.getByName("composeDown")


    jar.enabled = false // empty jar
}

